function showSuccess(t){Messenger().post({message:t,type:"success",showCloseButton:!0})}function showErrorMessage(t){Messenger().post({message:t,type:"error",showCloseButton:!1})}function tryAgain(){var t=0;Messenger().run({errorMessage:"Error destroying alien planet",successMessage:"Alien planet destroyed!",action:function(e){return++t<3?e.error({status:500,readyState:0,responseText:0}):e.success()}})}!function(t){var e=function(e,n){this.element=t(e),this.picker=t('<div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle"></div><div class="slider-handle"></div></div><div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div></div>').insertBefore(this.element).append(this.element),this.id=this.element.data("slider-id")||n.id,this.id&&(this.picker[0].id=this.id),"undefined"!=typeof Modernizr&&Modernizr.touch&&(this.touchCapable=!0);var i=this.element.data("slider-tooltip")||n.tooltip;switch(this.tooltip=this.picker.find(".tooltip"),this.tooltipInner=this.tooltip.find("div.tooltip-inner"),this.orientation=this.element.data("slider-orientation")||n.orientation,this.orientation){case"vertical":this.picker.addClass("slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this.tooltip.addClass("right")[0].style.left="100%";break;default:this.picker.addClass("slider-horizontal").css("width",this.element.outerWidth()),this.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this.tooltip.addClass("top")[0].style.top=-this.tooltip.outerHeight()-14+"px"}this.min=this.element.data("slider-min")||n.min,this.max=this.element.data("slider-max")||n.max,this.step=this.element.data("slider-step")||n.step,this.value=this.element.data("slider-value")||n.value,this.value[1]&&(this.range=!0),this.selection=this.element.data("slider-selection")||n.selection,this.selectionEl=this.picker.find(".slider-selection"),"none"===this.selection&&this.selectionEl.addClass("hide"),this.selectionElStyle=this.selectionEl[0].style,this.handle1=this.picker.find(".slider-handle:first"),this.handle1Stype=this.handle1[0].style,this.handle2=this.picker.find(".slider-handle:last"),this.handle2Stype=this.handle2[0].style;switch(this.element.data("slider-handle")||n.handle){case"round":this.handle1.addClass("round"),this.handle2.addClass("round");break;case"triangle":this.handle1.addClass("triangle"),this.handle2.addClass("triangle")}this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),"after"==this.selection?this.value[1]=this.max:this.value[1]=this.min),this.diff=this.max-this.min,this.percentage=[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff],this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos],this.formater=n.formater,this.layout(),this.touchCapable?this.picker.on({touchstart:t.proxy(this.mousedown,this)}):this.picker.on({mousedown:t.proxy(this.mousedown,this)}),"show"===i?this.picker.on({mouseenter:t.proxy(this.showTooltip,this),mouseleave:t.proxy(this.hideTooltip,this)}):this.tooltip.addClass("hide")};e.prototype={constructor:e,over:!1,inDrag:!1,showTooltip:function(){this.tooltip.addClass("in"),this.over=!0},hideTooltip:function(){!1===this.inDrag&&this.tooltip.removeClass("in"),this.over=!1},layout:function(){this.handle1Stype[this.stylePos]=this.percentage[0]+"%",this.handle2Stype[this.stylePos]=this.percentage[1]+"%","vertical"==this.orientation?(this.selectionElStyle.top=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.height=Math.abs(this.percentage[0]-this.percentage[1])+"%"):(this.selectionElStyle.left=Math.min(this.percentage[0],this.percentage[1])+"%",this.selectionElStyle.width=Math.abs(this.percentage[0]-this.percentage[1])+"%"),this.range?(this.tooltipInner.text(this.formater(this.value[0])+" : "+this.formater(this.value[1])),this.tooltip[0].style[this.stylePos]=this.size*(this.percentage[0]+(this.percentage[1]-this.percentage[0])/2)/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px"):(this.tooltipInner.text(this.formater(this.value[0])),this.tooltip[0].style[this.stylePos]=this.size*this.percentage[0]/100-("vertical"===this.orientation?this.tooltip.outerHeight()/2:this.tooltip.outerWidth()/2)+"px")},mousedown:function(e){this.touchCapable&&"touchstart"===e.type&&(e=e.originalEvent),this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos];var n=this.getPercentage(e);if(this.range){var i=Math.abs(this.percentage[0]-n),s=Math.abs(this.percentage[1]-n);this.dragged=i<s?0:1}else this.dragged=0;this.percentage[this.dragged]=n,this.layout(),this.touchCapable?t(document).on({touchmove:t.proxy(this.mousemove,this),touchend:t.proxy(this.mouseup,this)}):t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),this.inDrag=!0;var r=this.calculateValue();return this.element.trigger({type:"slideStart",value:r}).trigger({type:"slide",value:r}),!1},mousemove:function(t){this.touchCapable&&"touchmove"===t.type&&(t=t.originalEvent);var e=this.getPercentage(t);this.range&&(0===this.dragged&&this.percentage[1]<e?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>e&&(this.percentage[1]=this.percentage[0],this.dragged=0)),this.percentage[this.dragged]=e,this.layout();var n=this.calculateValue();return this.element.trigger({type:"slide",value:n}).data("value",n).prop("value",n),!1},mouseup:function(){this.touchCapable?t(document).off({touchmove:this.mousemove,touchend:this.mouseup}):t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.inDrag=!1,0==this.over&&this.hideTooltip(),this.element;var e=this.calculateValue();return this.element.trigger({type:"slideStop",value:e}).data("value",e).prop("value",e),!1},calculateValue:function(){var t;return this.range?(t=[this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.min+Math.round(this.diff*this.percentage[1]/100/this.step)*this.step],this.value=t):(t=this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step,this.value=[t,this.value[1]]),t},getPercentage:function(t){this.touchCapable&&(t=t.touches[0]);var e=100*(t[this.mousePos]-this.offset[this.stylePos])/this.size;return e=Math.round(e/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,e))},getValue:function(){return this.range?this.value:this.value[0]},setValue:function(t){this.value=t,this.range?(this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),"after"==this.selection?this.value[1]=this.max:this.value[1]=this.min),this.diff=this.max-this.min,this.percentage=[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff],this.layout()}},t.fn.slider=function(n,i){return this.each(function(){var s=t(this),r=s.data("slider"),o="object"==typeof n&&n;r||s.data("slider",r=new e(this,t.extend({},t.fn.slider.defaults,o))),"string"==typeof n&&r[n](i)})},t.fn.slider.defaults={min:0,max:10,step:1,orientation:"horizontal",value:5,selection:"before",tooltip:"show",handle:"round",formater:function(t){return t}},t.fn.slider.Constructor=e}(window.jQuery),function(t,e,n,i){function s(n,i){this.w=t(e),this.el=t(n),this.options=t.extend({},u,i),this.init()}var r="ontouchstart"in e,o=function(){var t=n.createElement("div"),i=n.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",i.appendChild(t);var s=e.getComputedStyle&&"auto"===e.getComputedStyle(t,"").pointerEvents;return i.removeChild(t),!!s}(),a=r?"touchstart":"mousedown",l=r?"touchmove":"mousemove",h=r?"touchend":"mouseup";eCancel=r?"touchcancel":"mouseup";var u={listNodeName:"ol",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",emptyClass:"dd-empty",expandBtnHTML:'<button data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20};s.prototype={init:function(){var n=this;n.reset(),n.el.data("nestable-group",this.options.group),n.placeEl=t('<div class="'+n.options.placeClass+'"/>'),t.each(this.el.find(n.options.itemNodeName),function(e,i){n.setParent(t(i))}),n.el.on("click","button",function(e){if(!n.dragEl&&(r||0===e.button)){var i=t(e.currentTarget),s=i.data("action"),o=i.parent(n.options.itemNodeName);"collapse"===s&&n.collapseItem(o),"expand"===s&&n.expandItem(o)}});var i=function(e){var i=t(e.target);if(!i.hasClass(n.options.handleClass)){if(i.closest("."+n.options.noDragClass).length)return;i=i.closest("."+n.options.handleClass)}!i.length||n.dragEl||!r&&0!==e.button||r&&1!==e.touches.length||(e.preventDefault(),n.dragStart(r?e.touches[0]:e))},s=function(t){n.dragEl&&(t.preventDefault(),n.dragMove(r?t.touches[0]:t))},o=function(t){n.dragEl&&(t.preventDefault(),n.dragStop(r?t.touches[0]:t))};r?(n.el[0].addEventListener(a,i,!1),e.addEventListener(l,s,!1),e.addEventListener(h,o,!1),e.addEventListener(eCancel,o,!1)):(n.el.on(a,i),n.w.on(l,s),n.w.on(h,o))},serialize:function(){var e=0,n=this;return step=function(e,i){var s=[];return e.children(n.options.itemNodeName).each(function(){var e=t(this),r=t.extend({},e.data()),o=e.children(n.options.listNodeName);o.length&&(r.children=step(o,i+1)),s.push(r)}),s},step(n.el.find(n.options.listNodeName).first(),e)},serialise:function(){return this.serialize()},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass),t.children('[data-action="expand"]').hide(),t.children('[data-action="collapse"]').show(),t.children(this.options.listNodeName).show()},collapseItem:function(t){t.children(this.options.listNodeName).length&&(t.addClass(this.options.collapsedClass),t.children('[data-action="collapse"]').hide(),t.children('[data-action="expand"]').show(),t.children(this.options.listNodeName).hide())},expandAll:function(){var e=this;e.el.find(e.options.itemNodeName).each(function(){e.expandItem(t(this))})},collapseAll:function(){var e=this;e.el.find(e.options.itemNodeName).each(function(){e.collapseItem(t(this))})},setParent:function(e){e.children(this.options.listNodeName).length&&(e.prepend(t(this.options.expandBtnHTML)),e.prepend(t(this.options.collapseBtnHTML))),e.children('[data-action="expand"]').hide()},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(e){var s=this.mouse,r=t(e.target),o=r.closest(this.options.itemNodeName);this.placeEl.css("height",o.height()),s.offsetX=e.offsetX!==i?e.offsetX:e.pageX-r.offset().left,s.offsetY=e.offsetY!==i?e.offsetY:e.pageY-r.offset().top,s.startX=s.lastX=e.pageX,s.startY=s.lastY=e.pageY,this.dragRootEl=this.el,this.dragEl=t(n.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",o.width()),o.after(this.placeEl),o[0].parentNode.removeChild(o[0]),o.appendTo(this.dragEl),t(n.body).append(this.dragEl),this.dragEl.css({left:e.pageX-s.offsetX,top:e.pageY-s.offsetY});var a,l,h=this.dragEl.find(this.options.itemNodeName);for(a=0;a<h.length;a++)(l=t(h[a]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=l)},dragStop:function(){var t=this.dragEl.children(this.options.itemNodeName).first();t[0].parentNode.removeChild(t[0]),this.placeEl.replaceWith(t),this.dragEl.remove(),this.el.trigger("change"),this.hasNewRoot&&this.dragRootEl.trigger("change"),this.reset()},dragMove:function(i){var s,r,a,l=this.options,h=this.mouse;this.dragEl.css({left:i.pageX-h.offsetX,top:i.pageY-h.offsetY}),h.lastX=h.nowX,h.lastY=h.nowY,h.nowX=i.pageX,h.nowY=i.pageY,h.distX=h.nowX-h.lastX,h.distY=h.nowY-h.lastY,h.lastDirX=h.dirX,h.lastDirY=h.dirY,h.dirX=0===h.distX?0:h.distX>0?1:-1,h.dirY=0===h.distY?0:h.distY>0?1:-1;var u=Math.abs(h.distX)>Math.abs(h.distY)?1:0;if(!h.moving)return h.dirAx=u,void(h.moving=!0);h.dirAx!==u?(h.distAxX=0,h.distAxY=0):(h.distAxX+=Math.abs(h.distX),0!==h.dirX&&h.dirX!==h.lastDirX&&(h.distAxX=0),h.distAxY+=Math.abs(h.distY),0!==h.dirY&&h.dirY!==h.lastDirY&&(h.distAxY=0)),h.dirAx=u,h.dirAx&&h.distAxX>=l.threshold&&(h.distAxX=0,a=this.placeEl.prev(l.itemNodeName),h.distX>0&&a.length&&!a.hasClass(l.collapsedClass)&&(s=a.find(l.listNodeName).last(),this.placeEl.parents(l.listNodeName).length+this.dragDepth<=l.maxDepth&&(s.length?(s=a.children(l.listNodeName).last()).append(this.placeEl):((s=t("<"+l.listNodeName+"/>").addClass(l.listClass)).append(this.placeEl),a.append(s),this.setParent(a)))),h.distX<0&&(this.placeEl.next(l.itemNodeName).length||(r=this.placeEl.parent(),this.placeEl.closest(l.itemNodeName).after(this.placeEl),r.children().length||this.unsetParent(r.parent()))));var c=!1;if(o||(this.dragEl[0].style.visibility="hidden"),this.pointEl=t(n.elementFromPoint(i.pageX-n.body.scrollLeft,i.pageY-(e.pageYOffset||n.documentElement.scrollTop))),o||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(l.handleClass)&&(this.pointEl=this.pointEl.parent(l.itemNodeName)),this.pointEl.hasClass(l.emptyClass))c=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(l.itemClass))return;var d=this.pointEl.closest("."+l.rootClass),p=this.dragRootEl.data("nestable-id")!==d.data("nestable-id");if(!h.dirAx||p||c){if(p&&l.group!==d.data("nestable-group"))return;if(this.dragDepth-1+this.pointEl.parents(l.listNodeName).length>l.maxDepth)return;var f=i.pageY<this.pointEl.offset().top+this.pointEl.height()/2;r=this.placeEl.parent(),c?((s=t(n.createElement(l.listNodeName)).addClass(l.listClass)).append(this.placeEl),this.pointEl.replaceWith(s)):f?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),r.children().length||this.unsetParent(r.parent()),this.dragRootEl.find(l.itemNodeName).length||this.dragRootEl.append('<div class="'+l.emptyClass+'"/>'),p&&(this.dragRootEl=d,this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}}},t.fn.nestable=function(e){var n=this,i=this;return n.each(function(){var n=t(this).data("nestable");n?"string"==typeof e&&"function"==typeof n[e]&&(i=n[e]()):(t(this).data("nestable",new s(this,e)),t(this).data("nestable-id",(new Date).getTime()))}),i||n}}(window.jQuery||window.Zepto,window,document),function(){var t=this,e=t._,n={},i=Array.prototype,s=Object.prototype,r=Function.prototype,o=i.push,a=i.slice,l=i.concat,h=s.toString,u=s.hasOwnProperty,c=i.forEach,d=i.map,p=i.reduce,f=i.reduceRight,g=i.filter,v=i.every,m=i.some,y=i.indexOf,_=i.lastIndexOf,w=Array.isArray,b=Object.keys,x=r.bind,E=function(t){return t instanceof E?t:this instanceof E?void(this._wrapped=t):new E(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=E),exports._=E):t._=E,E.VERSION="1.5.2";var C=E.each=E.forEach=function(t,e,i){if(null!=t)if(c&&t.forEach===c)t.forEach(e,i);else if(t.length===+t.length){for(var s=0,r=t.length;r>s;s++)if(e.call(i,t[s],s,t)===n)return}else{var o=E.keys(t);for(s=0,r=o.length;r>s;s++)if(e.call(i,t[o[s]],o[s],t)===n)return}};E.map=E.collect=function(t,e,n){var i=[];return null==t?i:d&&t.map===d?t.map(e,n):(C(t,function(t,s,r){i.push(e.call(n,t,s,r))}),i)};var k="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(t,e,n,i){var s=arguments.length>2;if(null==t&&(t=[]),p&&t.reduce===p)return i&&(e=E.bind(e,i)),s?t.reduce(e,n):t.reduce(e);if(C(t,function(t,r,o){s?n=e.call(i,n,t,r,o):(n=t,s=!0)}),!s)throw new TypeError(k);return n},E.reduceRight=E.foldr=function(t,e,n,i){var s=arguments.length>2;if(null==t&&(t=[]),f&&t.reduceRight===f)return i&&(e=E.bind(e,i)),s?t.reduceRight(e,n):t.reduceRight(e);var r=t.length;if(r!==+r){var o=E.keys(t);r=o.length}if(C(t,function(a,l,h){l=o?o[--r]:--r,s?n=e.call(i,n,t[l],l,h):(n=t[l],s=!0)}),!s)throw new TypeError(k);return n},E.find=E.detect=function(t,e,n){var i;return M(t,function(t,s,r){return e.call(n,t,s,r)?(i=t,!0):void 0}),i},E.filter=E.select=function(t,e,n){var i=[];return null==t?i:g&&t.filter===g?t.filter(e,n):(C(t,function(t,s,r){e.call(n,t,s,r)&&i.push(t)}),i)},E.reject=function(t,e,n){return E.filter(t,function(t,i,s){return!e.call(n,t,i,s)},n)},E.every=E.all=function(t,e,i){e||(e=E.identity);var s=!0;return null==t?s:v&&t.every===v?t.every(e,i):(C(t,function(t,r,o){return(s=s&&e.call(i,t,r,o))?void 0:n}),!!s)};var M=E.some=E.any=function(t,e,i){e||(e=E.identity);var s=!1;return null==t?s:m&&t.some===m?t.some(e,i):(C(t,function(t,r,o){return s||(s=e.call(i,t,r,o))?n:void 0}),!!s)};E.contains=E.include=function(t,e){return null!=t&&(y&&t.indexOf===y?-1!=t.indexOf(e):M(t,function(t){return t===e}))},E.invoke=function(t,e){var n=a.call(arguments,2),i=E.isFunction(e);return E.map(t,function(t){return(i?e:t[e]).apply(t,n)})},E.pluck=function(t,e){return E.map(t,function(t){return t[e]})},E.where=function(t,e,n){return E.isEmpty(e)?n?void 0:[]:E[n?"find":"filter"](t,function(t){for(var n in e)if(e[n]!==t[n])return!1;return!0})},E.findWhere=function(t,e){return E.where(t,e,!0)},E.max=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!e&&E.isEmpty(t))return-1/0;var i={computed:-1/0,value:-1/0};return C(t,function(t,s,r){var o=e?e.call(n,t,s,r):t;o>i.computed&&(i={value:t,computed:o})}),i.value},E.min=function(t,e,n){if(!e&&E.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!e&&E.isEmpty(t))return 1/0;var i={computed:1/0,value:1/0};return C(t,function(t,s,r){var o=e?e.call(n,t,s,r):t;o<i.computed&&(i={value:t,computed:o})}),i.value},E.shuffle=function(t){var e,n=0,i=[];return C(t,function(t){e=E.random(n++),i[n-1]=i[e],i[e]=t}),i},E.sample=function(t,e,n){return arguments.length<2||n?t[E.random(t.length-1)]:E.shuffle(t).slice(0,Math.max(0,e))};var N=function(t){return E.isFunction(t)?t:function(e){return e[t]}};E.sortBy=function(t,e,n){var i=N(e);return E.pluck(E.map(t,function(t,e,s){return{value:t,index:e,criteria:i.call(n,t,e,s)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return t.index-e.index}),"value")};var A=function(t){return function(e,n,i){var s={},r=null==n?E.identity:N(n);return C(e,function(n,o){var a=r.call(i,n,o,e);t(s,a,n)}),s}};E.groupBy=A(function(t,e,n){(E.has(t,e)?t[e]:t[e]=[]).push(n)}),E.indexBy=A(function(t,e,n){t[e]=n}),E.countBy=A(function(t,e){E.has(t,e)?t[e]++:t[e]=1}),E.sortedIndex=function(t,e,n,i){for(var s=(n=null==n?E.identity:N(n)).call(i,e),r=0,o=t.length;o>r;){var a=r+o>>>1;n.call(i,t[a])<s?r=a+1:o=a}return r},E.toArray=function(t){return t?E.isArray(t)?a.call(t):t.length===+t.length?E.map(t,E.identity):E.values(t):[]},E.size=function(t){return null==t?0:t.length===+t.length?t.length:E.keys(t).length},E.first=E.head=E.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:a.call(t,0,e)},E.initial=function(t,e,n){return a.call(t,0,t.length-(null==e||n?1:e))},E.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:a.call(t,Math.max(t.length-e,0))},E.rest=E.tail=E.drop=function(t,e,n){return a.call(t,null==e||n?1:e)},E.compact=function(t){return E.filter(t,E.identity)};var $=function(t,e,n){return e&&E.every(t,E.isArray)?l.apply(n,t):(C(t,function(t){E.isArray(t)||E.isArguments(t)?e?o.apply(n,t):$(t,e,n):n.push(t)}),n)};E.flatten=function(t,e){return $(t,e,[])},E.without=function(t){return E.difference(t,a.call(arguments,1))},E.uniq=E.unique=function(t,e,n,i){E.isFunction(e)&&(i=n,n=e,e=!1);var s=n?E.map(t,n,i):t,r=[],o=[];return C(s,function(n,i){(e?i&&o[o.length-1]===n:E.contains(o,n))||(o.push(n),r.push(t[i]))}),r},E.union=function(){return E.uniq(E.flatten(arguments,!0))},E.intersection=function(t){var e=a.call(arguments,1);return E.filter(E.uniq(t),function(t){return E.every(e,function(e){return E.indexOf(e,t)>=0})})},E.difference=function(t){var e=l.apply(i,a.call(arguments,1));return E.filter(t,function(t){return!E.contains(e,t)})},E.zip=function(){for(var t=E.max(E.pluck(arguments,"length").concat(0)),e=new Array(t),n=0;t>n;n++)e[n]=E.pluck(arguments,""+n);return e},E.object=function(t,e){if(null==t)return{};for(var n={},i=0,s=t.length;s>i;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},E.indexOf=function(t,e,n){if(null==t)return-1;var i=0,s=t.length;if(n){if("number"!=typeof n)return i=E.sortedIndex(t,e),t[i]===e?i:-1;i=0>n?Math.max(0,s+n):n}if(y&&t.indexOf===y)return t.indexOf(e,n);for(;s>i;i++)if(t[i]===e)return i;return-1},E.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=null!=n;if(_&&t.lastIndexOf===_)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var s=i?n:t.length;s--;)if(t[s]===e)return s;return-1},E.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/n),0),s=0,r=new Array(i);i>s;)r[s++]=t,t+=n;return r};var j=function(){};E.bind=function(t,e){var n,i;if(x&&t.bind===x)return x.apply(t,a.call(arguments,1));if(!E.isFunction(t))throw new TypeError;return n=a.call(arguments,2),i=function(){if(!(this instanceof i))return t.apply(e,n.concat(a.call(arguments)));j.prototype=t.prototype;var s=new j;j.prototype=null;var r=t.apply(s,n.concat(a.call(arguments)));return Object(r)===r?r:s}},E.partial=function(t){var e=a.call(arguments,1);return function(){return t.apply(this,e.concat(a.call(arguments)))}},E.bindAll=function(t){var e=a.call(arguments,1);if(0===e.length)throw new Error("bindAll must be passed function names");return C(e,function(e){t[e]=E.bind(t[e],t)}),t},E.memoize=function(t,e){var n={};return e||(e=E.identity),function(){var i=e.apply(this,arguments);return E.has(n,i)?n[i]:n[i]=t.apply(this,arguments)}},E.delay=function(t,e){var n=a.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},E.defer=function(t){return E.delay.apply(E,[t,1].concat(a.call(arguments,1)))},E.throttle=function(t,e,n){var i,s,r,o=null,a=0;n||(n={});var l=function(){a=!1===n.leading?0:new Date,o=null,r=t.apply(i,s)};return function(){var h=new Date;a||!1!==n.leading||(a=h);var u=e-(h-a);return i=this,s=arguments,0>=u?(clearTimeout(o),o=null,a=h,r=t.apply(i,s)):o||!1===n.trailing||(o=setTimeout(l,u)),r}},E.debounce=function(t,e,n){var i,s,r,o,a;return function(){r=this,s=arguments,o=new Date;var l=function(){var h=new Date-o;e>h?i=setTimeout(l,e-h):(i=null,n||(a=t.apply(r,s)))},h=n&&!i;return i||(i=setTimeout(l,e)),h&&(a=t.apply(r,s)),a}},E.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}},E.wrap=function(t,e){return function(){var n=[t];return o.apply(n,arguments),e.apply(this,n)}},E.compose=function(){var t=arguments;return function(){for(var e=arguments,n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},E.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},E.keys=b||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)E.has(t,n)&&e.push(n);return e},E.values=function(t){for(var e=E.keys(t),n=e.length,i=new Array(n),s=0;n>s;s++)i[s]=t[e[s]];return i},E.pairs=function(t){for(var e=E.keys(t),n=e.length,i=new Array(n),s=0;n>s;s++)i[s]=[e[s],t[e[s]]];return i},E.invert=function(t){for(var e={},n=E.keys(t),i=0,s=n.length;s>i;i++)e[t[n[i]]]=n[i];return e},E.functions=E.methods=function(t){var e=[];for(var n in t)E.isFunction(t[n])&&e.push(n);return e.sort()},E.extend=function(t){return C(a.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},E.pick=function(t){var e={},n=l.apply(i,a.call(arguments,1));return C(n,function(n){n in t&&(e[n]=t[n])}),e},E.omit=function(t){var e={},n=l.apply(i,a.call(arguments,1));for(var s in t)E.contains(n,s)||(e[s]=t[s]);return e},E.defaults=function(t){return C(a.call(arguments,1),function(e){if(e)for(var n in e)void 0===t[n]&&(t[n]=e[n])}),t},E.clone=function(t){return E.isObject(t)?E.isArray(t)?t.slice():E.extend({},t):t},E.tap=function(t,e){return e(t),t};var S=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof E&&(t=t._wrapped),e instanceof E&&(e=e._wrapped);var s=h.call(t);if(s!=h.call(e))return!1;switch(s){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var r=n.length;r--;)if(n[r]==t)return i[r]==e;var o=t.constructor,a=e.constructor;if(o!==a&&!(E.isFunction(o)&&o instanceof o&&E.isFunction(a)&&a instanceof a))return!1;n.push(t),i.push(e);var l=0,u=!0;if("[object Array]"==s){if(l=t.length,u=l==e.length)for(;l--&&(u=S(t[l],e[l],n,i)););}else{for(var c in t)if(E.has(t,c)&&(l++,!(u=E.has(e,c)&&S(t[c],e[c],n,i))))break;if(u){for(c in e)if(E.has(e,c)&&!l--)break;u=!l}}return n.pop(),i.pop(),u};E.isEqual=function(t,e){return S(t,e,[],[])},E.isEmpty=function(t){if(null==t)return!0;if(E.isArray(t)||E.isString(t))return 0===t.length;for(var e in t)if(E.has(t,e))return!1;return!0},E.isElement=function(t){return!(!t||1!==t.nodeType)},E.isArray=w||function(t){return"[object Array]"==h.call(t)},E.isObject=function(t){return t===Object(t)},C(["Arguments","Function","String","Number","Date","RegExp"],function(t){E["is"+t]=function(e){return h.call(e)=="[object "+t+"]"}}),E.isArguments(arguments)||(E.isArguments=function(t){return!(!t||!E.has(t,"callee"))}),"function"!=typeof/./&&(E.isFunction=function(t){return"function"==typeof t}),E.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},E.isNaN=function(t){return E.isNumber(t)&&t!=+t},E.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==h.call(t)},E.isNull=function(t){return null===t},E.isUndefined=function(t){return void 0===t},E.has=function(t,e){return u.call(t,e)},E.noConflict=function(){return t._=e,this},E.identity=function(t){return t},E.times=function(t,e,n){for(var i=Array(Math.max(0,t)),s=0;t>s;s++)i[s]=e.call(n,s);return i},E.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var T={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};T.unescape=E.invert(T.escape);var O={escape:new RegExp("["+E.keys(T.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(T.unescape).join("|")+")","g")};E.each(["escape","unescape"],function(t){E[t]=function(e){return null==e?"":(""+e).replace(O[t],function(e){return T[t][e]})}}),E.result=function(t,e){if(null!=t){var n=t[e];return E.isFunction(n)?n.call(t):n}},E.mixin=function(t){C(E.functions(t),function(e){var n=E[e]=t[e];E.prototype[e]=function(){var t=[this._wrapped];return o.apply(t,arguments),R.call(this,n.apply(E,t))}})};var I=0;E.uniqueId=function(t){var e=++I+"";return t?t+e:e},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},X=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(t,e,n){var i;n=E.defaults({},n,E.templateSettings);var s=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),r=0,o="__p+='";t.replace(s,function(e,n,i,s,a){return o+=t.slice(r,a).replace(X,function(t){return"\\"+B[t]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),s&&(o+="';\n"+s+"\n__p+='"),r=a+e.length,e}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{i=new Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(e)return i(e,E);var l=function(t){return i.call(this,t,E)};return l.source="function("+(n.variable||"obj")+"){\n"+o+"}",l},E.chain=function(t){return E(t).chain()};var R=function(t){return this._chain?E(t).chain():t};E.mixin(E),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];E.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!=t&&"splice"!=t||0!==n.length||delete n[0],R.call(this,n)}}),C(["concat","join","slice"],function(t){var e=i[t];E.prototype[t]=function(){return R.call(this,e.apply(this._wrapped,arguments))}}),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var t,e=this,n=e.Backbone,i=[],s=(i.push,i.slice);i.splice;(t="undefined"!=typeof exports?exports:e.Backbone={}).VERSION="1.1.0";var r=e._;r||"undefined"==typeof require||(r=require("underscore")),t.$=e.jQuery||e.Zepto||e.ender||e.$,t.noConflict=function(){return e.Backbone=n,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=t.Events={on:function(t,e,n){if(!l(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});return(this._events[t]||(this._events[t]=[])).push({callback:e,context:n,ctx:n||this}),this},once:function(t,e,n){if(!l(this,"once",t,[e,n])||!e)return this;var i=this,s=r.once(function(){i.off(t,s),e.apply(this,arguments)});return s._callback=e,this.on(t,s,n)},off:function(t,e,n){var i,s,o,a,h,u,c,d;if(!this._events||!l(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._events={},this;for(h=0,u=(a=t?[t]:r.keys(this._events)).length;h<u;h++)if(t=a[h],o=this._events[t]){if(this._events[t]=i=[],e||n)for(c=0,d=o.length;c<d;c++)s=o[c],(e&&e!==s.callback&&e!==s.callback._callback||n&&n!==s.context)&&i.push(s);i.length||delete this._events[t]}return this},trigger:function(t){if(!this._events)return this;var e=s.call(arguments,1);if(!l(this,"trigger",t,e))return this;var n=this._events[t],i=this._events.all;return n&&h(n,e),i&&h(i,arguments),this},stopListening:function(t,e,n){var i=this._listeningTo;if(!i)return this;var s=!e&&!n;n||"object"!=typeof e||(n=this),t&&((i={})[t._listenId]=t);for(var o in i)(t=i[o]).off(e,n,this),(s||r.isEmpty(t._events))&&delete this._listeningTo[o];return this}},a=/\s+/,l=function(t,e,n,i){if(!n)return!0;if("object"==typeof n){for(var s in n)t[e].apply(t,[s,n[s]].concat(i));return!1}if(a.test(n)){for(var r=n.split(a),o=0,l=r.length;o<l;o++)t[e].apply(t,[r[o]].concat(i));return!1}return!0},h=function(t,e){var n,i=-1,s=t.length,r=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++i<s;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,o);return;case 3:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,o,a);return;default:for(;++i<s;)(n=t[i]).callback.apply(n.ctx,e)}},u={listenTo:"on",listenToOnce:"once"};r.each(u,function(t,e){o[e]=function(e,n,i){return(this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=r.uniqueId("l"))]=e,i||"object"!=typeof n||(i=this),e[t](n,i,this),this}}),o.bind=o.on,o.unbind=o.off,r.extend(t,o);var c=t.Model=function(t,e){var n=t||{};e||(e={}),this.cid=r.uniqueId("c"),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{}),n=r.defaults({},n,r.result(this,"defaults")),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};r.extend(c.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return r.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return r.escape(this.get(t))},has:function(t){return null!=this.get(t)},set:function(t,e,n){var i,s,o,a,l,h,u,c;if(null==t)return this;if("object"==typeof t?(s=t,n=e):(s={})[t]=e,n||(n={}),!this._validate(s,n))return!1;o=n.unset,l=n.silent,a=[],h=this._changing,this._changing=!0,h||(this._previousAttributes=r.clone(this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)e=s[i],r.isEqual(c[i],e)||a.push(i),r.isEqual(u[i],e)?delete this.changed[i]:this.changed[i]=e,o?delete c[i]:c[i]=e;if(!l){a.length&&(this._pending=!0)
;for(var d=0,p=a.length;d<p;d++)this.trigger("change:"+a[d],this,c[a[d]],n)}if(h)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,r.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,r.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!r.isEmpty(this.changed):r.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&r.clone(this.changed);var e,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in t)r.isEqual(i[s],e=t[s])||((n||(n={}))[s]=e);return n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return r.clone(this._previousAttributes)},fetch:function(t){void 0===(t=t?r.clone(t):{}).parse&&(t.parse=!0);var e=this,n=t.success;return t.success=function(i){if(!e.set(e.parse(i,t),t))return!1;n&&n(e,i,t),e.trigger("sync",e,i,t)},B(this,t),this.sync("read",this,t)},save:function(t,e,n){var i,s,o,a=this.attributes;if(null==t||"object"==typeof t?(i=t,n=e):(i={})[t]=e,n=r.extend({validate:!0},n),i&&!n.wait){if(!this.set(i,n))return!1}else if(!this._validate(i,n))return!1;i&&n.wait&&(this.attributes=r.extend({},a,i)),void 0===n.parse&&(n.parse=!0);var l=this,h=n.success;return n.success=function(t){l.attributes=a;var e=l.parse(t,n);if(n.wait&&(e=r.extend(i||{},e)),r.isObject(e)&&!l.set(e,n))return!1;h&&h(l,t,n),l.trigger("sync",l,t,n)},B(this,n),"patch"===(s=this.isNew()?"create":n.patch?"patch":"update")&&(n.attrs=i),o=this.sync(s,this,n),i&&n.wait&&(this.attributes=a),o},destroy:function(t){var e=this,n=(t=t?r.clone(t):{}).success,i=function(){e.trigger("destroy",e,e.collection,t)};if(t.success=function(s){(t.wait||e.isNew())&&i(),n&&n(e,s,t),e.isNew()||e.trigger("sync",e,s,t)},this.isNew())return t.success(),!1;B(this,t);var s=this.sync("delete",this,t);return t.wait||i(),s},url:function(){var t=r.result(this,"urlRoot")||r.result(this.collection,"url")||P();return this.isNew()?t:t+("/"===t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(t){return this._validate({},r.extend(t||{},{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=r.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,r.extend(e,{validationError:n})),!1)}});var d=["keys","values","pairs","invert","pick","omit"];r.each(d,function(t){c.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.attributes),r[t].apply(r,e)}});var p=t.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,r.extend({silent:!0},e))},f={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};r.extend(p.prototype,o,{model:c,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return t.sync.apply(this,arguments)},add:function(t,e){return this.set(t,r.extend({merge:!1},e,g))},remove:function(t,e){var n=!r.isArray(t);t=n?[t]:r.clone(t),e||(e={});var i,s,o,a;for(i=0,s=t.length;i<s;i++)(a=t[i]=this.get(t[i]))&&(delete this._byId[a.id],delete this._byId[a.cid],o=this.indexOf(a),this.models.splice(o,1),this.length--,e.silent||(e.index=o,a.trigger("remove",a,this,e)),this._removeReference(a));return n?t[0]:t},set:function(t,e){(e=r.defaults({},e,f)).parse&&(t=this.parse(t,e));var n=!r.isArray(t);t=n?t?[t]:[]:r.clone(t);var i,s,o,a,l,h,u,d=e.at,p=this.model,g=this.comparator&&null==d&&!1!==e.sort,v=r.isString(this.comparator)?this.comparator:null,m=[],y=[],_={},w=e.add,b=e.merge,x=e.remove,E=!(g||!w||!x)&&[];for(i=0,s=t.length;i<s;i++){if(l=t[i],o=l instanceof c?a=l:l[p.prototype.idAttribute],h=this.get(o))x&&(_[h.cid]=!0),b&&(l=l===a?a.attributes:l,e.parse&&(l=h.parse(l,e)),h.set(l,e),g&&!u&&h.hasChanged(v)&&(u=!0)),t[i]=h;else if(w){if(!(a=t[i]=this._prepareModel(l,e)))continue;m.push(a),a.on("all",this._onModelEvent,this),this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a)}E&&E.push(h||a)}if(x){for(i=0,s=this.length;i<s;++i)_[(a=this.models[i]).cid]||y.push(a);y.length&&this.remove(y,e)}if(m.length||E&&E.length)if(g&&(u=!0),this.length+=m.length,null!=d)for(i=0,s=m.length;i<s;i++)this.models.splice(d+i,0,m[i]);else{E&&(this.models.length=0);var C=E||m;for(i=0,s=C.length;i<s;i++)this.models.push(C[i])}if(u&&this.sort({silent:!0}),!e.silent){for(i=0,s=m.length;i<s;i++)(a=m[i]).trigger("add",a,this,e);(u||E&&E.length)&&this.trigger("sort",this,e)}return n?t[0]:t},reset:function(t,e){e||(e={});for(var n=0,i=this.models.length;n<i;n++)this._removeReference(this.models[n]);return e.previousModels=this.models,this._reset(),t=this.add(t,r.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,r.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return this.add(t,r.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t),e},slice:function(){return s.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t.id]||this._byId[t.cid]||this._byId[t]},at:function(t){return this.models[t]},where:function(t,e){return r.isEmpty(t)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var n in t)if(t[n]!==e.get(n))return!1;return!0})},findWhere:function(t){return this.where(t,!0)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return t||(t={}),r.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(r.bind(this.comparator,this)),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return r.invoke(this.models,"get",t)},fetch:function(t){void 0===(t=t?r.clone(t):{}).parse&&(t.parse=!0);var e=t.success,n=this;return t.success=function(i){var s=t.reset?"reset":"set";n[s](i,t),e&&e(n,i,t),n.trigger("sync",n,i,t)},B(this,t),this.sync("read",this,t)},create:function(t,e){if(e=e?r.clone(e):{},!(t=this._prepareModel(t,e)))return!1;e.wait||this.add(t,e);var n=this,i=e.success;return e.success=function(t,e,s){s.wait&&n.add(t,s),i&&i(t,e,s)},t.save(null,e),t},parse:function(t){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(t instanceof c)return t.collection||(t.collection=this),t;(e=e?r.clone(e):{}).collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],null!=e.id&&(this._byId[e.id]=e)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];r.each(v,function(t){p.prototype[t]=function(){var e=s.call(arguments);return e.unshift(this.models),r[t].apply(r,e)}});var m=["groupBy","countBy","sortBy"];r.each(m,function(t){p.prototype[t]=function(e,n){var i=r.isFunction(e)?e:function(t){return t.get(e)};return r[t](this.models,i,n)}});var y=t.View=function(t){this.cid=r.uniqueId("view"),t||(t={}),r.extend(this,r.pick(t,w)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName","events"];r.extend(y.prototype,o,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==n&&this.delegateEvents(),this},delegateEvents:function(t){if(!t&&!(t=r.result(this,"events")))return this;this.undelegateEvents();for(var e in t){var n=t[e];if(r.isFunction(n)||(n=this[t[e]]),n){var i=e.match(_),s=i[1],o=i[2];n=r.bind(n,this),s+=".delegateEvents"+this.cid,""===o?this.$el.on(s,n):this.$el.on(s,o,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(r.result(this,"el"),!1);else{var e=r.extend({},r.result(this,"attributes"));this.id&&(e.id=r.result(this,"id")),this.className&&(e["class"]=r.result(this,"className"));var n=t.$("<"+r.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,i){var s=x[e];r.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};if(i.url||(o.url=r.result(n,"url")||P()),null!=i.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(i.attrs||n.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),i.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",i.emulateJSON&&(o.data._method=s);var a=i.beforeSend;i.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",s),a)return a.apply(this,arguments)}}"GET"===o.type||i.emulateJSON||(o.processData=!1),"PATCH"===o.type&&b&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=i.xhr=t.ajax(r.extend(o,i));return n.trigger("request",n,l,i),l};var b=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var E=t.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,M=/\*\w+/g,N=/[\-{}\[\]+?.,\\\^$|#\s]/g;r.extend(E.prototype,o,{initialize:function(){},route:function(e,n,i){r.isRegExp(e)||(e=this._routeToRegExp(e)),r.isFunction(n)&&(i=n,n=""),i||(i=this[n]);var s=this;return t.history.route(e,function(r){var o=s._extractParameters(e,r);i&&i.apply(s,o),s.trigger.apply(s,["route:"+n].concat(o)),s.trigger("route",n,o),t.history.trigger("route",s,n,o)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=r.result(this,"routes");for(var t,e=r.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(N,"\\$&").replace(C,"(?:$1)?").replace(k,function(t,e){return e?t:"([^/]+)"}).replace(M,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return r.map(n,function(t){return t?decodeURIComponent(t):null})}});var A=t.History=function(){this.handlers=[],r.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},$=/^[#\/]|\s+$/g,j=/^\/+|\/+$/g,S=/msie [\w.]+/,T=/\/$/,O=/[?#].*$/;A.started=!1,r.extend(A.prototype,o,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var n=this.root.replace(T,"");t.indexOf(n)||(t=t.slice(n.length))}else t=this.getHash();return t.replace($,"")},start:function(e){if(A.started)throw new Error("Backbone.history has already been started");A.started=!0,this.options=r.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),i=document.documentMode,s=S.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(j,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!a)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace($,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),A.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(t){return t=this.fragment=this.getFragment(t),r.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(t,e){if(!A.started)return!1;e&&!0!==e||(e={trigger:!!e});var n=this.root+(t=this.getFragment(t||""));if(t=t.replace(O,""),this.fragment!==t){if(this.fragment=t,""===t&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,t,e.replace))}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),t.history=new A;var I=function(t,e){var n,i=this;n=t&&r.has(t,"constructor")?t.constructor:function(){return i.apply(this,arguments)},r.extend(n,i,e);var s=function(){this.constructor=n};return s.prototype=i.prototype,n.prototype=new s,t&&r.extend(n.prototype,t),n.__super__=i.prototype,n};c.extend=p.extend=E.extend=y.extend=A.extend=I;var P=function(){throw new Error('A "url" property or function must be specified')},B=function(t,e){var n=e.error;e.error=function(i){n&&n(t,i,e),t.trigger("error",t,i,e)}}}.call(this),function(){var t,e=window.Messenger;t=window.Messenger=function(){return t._call.apply(this,arguments)},window.Messenger.noConflict=function(){return window.Messenger=e,t}}(),window.Messenger._=function(){if(window._)return window._;var t=Array.prototype,e=Object.prototype,n=Function.prototype,i=(t.push,t.slice),s=(t.concat,e.toString);e.hasOwnProperty;var r=t.forEach,o=(t.map,t.reduce,t.reduceRight,t.filter),a=(t.every,t.some,t.indexOf,t.lastIndexOf,Array.isArray,Object.keys),l=n.bind,h={},u={},c=h.each=h.forEach=function(t,e,n){if(null!=t)if(r&&t.forEach===r)t.forEach(e,n);else if(t.length===+t.length){for(var i=0,s=t.length;s>i;i++)if(e.call(n,t[i],i,t)===u)return}else for(var o in t)if(h.has(t,o)&&e.call(n,t[o],o,t)===u)return};h.result=function(t,e){if(null==t)return null;var n=t[e];return h.isFunction(n)?n.call(t):n},h.once=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments),t=null,e)}};var d=0;return h.uniqueId=function(t){var e=++d+"";return t?t+e:e},h.filter=h.select=function(t,e,n){var i=[];return null==t?i:o&&t.filter===o?t.filter(e,n):(c(t,function(t,s,r){e.call(n,t,s,r)&&(i[i.length]=t)}),i)},c(["Arguments","Function","String","Number","Date","RegExp"],function(t){h["is"+t]=function(e){return s.call(e)=="[object "+t+"]"}}),h.defaults=function(t){return c(i.call(arguments,1),function(e){if(e)for(var n in e)null==t[n]&&(t[n]=e[n])}),t},h.extend=function(t){return c(i.call(arguments,1),function(e){if(e)for(var n in e)t[n]=e[n]}),t},h.keys=a||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)h.has(t,n)&&(e[e.length]=n);return e},h.bind=function(t,e){if(t.bind===l&&l)return l.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}},h.isObject=function(t){return t===Object(t)},h}(),window.Messenger.Events=function(){if(window.Backbone&&Backbone.Events)return Backbone.Events;return function(){var t=/\s+/,e=function(e,n,i,s){if(!i)return!0;if("object"==typeof i)for(var r in i)e[n].apply(e,[r,i[r]].concat(s));else{if(!t.test(i))return!0;for(var o=i.split(t),a=0,l=o.length;l>a;a++)e[n].apply(e,[o[a]].concat(s))}},n=function(t,e){var n,i=-1,s=t.length;switch(e.length){case 0:for(;s>++i;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;s>++i;)(n=t[i]).callback.call(n.ctx,e[0]);return;case 2:for(;s>++i;)(n=t[i]).callback.call(n.ctx,e[0],e[1]);return;case 3:for(;s>++i;)(n=t[i]).callback.call(n.ctx,e[0],e[1],e[2]);return;default:for(;s>++i;)(n=t[i]).callback.apply(n.ctx,e)}},i={on:function(t,n,i){if(!e(this,"on",t,[n,i])||!n)return this;this._events||(this._events={});return(this._events[t]||(this._events[t]=[])).push({callback:n,context:i,ctx:i||this}),this},once:function(t,n,i){if(!e(this,"once",t,[n,i])||!n)return this;var s=this,r=_.once(function(){s.off(t,r),n.apply(this,arguments)});return r._callback=n,this.on(t,r,i),this},off:function(t,n,i){var s,r,o,a,l,h,u,c;if(!this._events||!e(this,"off",t,[n,i]))return this;if(!t&&!n&&!i)return this._events={},this;for(l=0,h=(a=t?[t]:_.keys(this._events)).length;h>l;l++)if(t=a[l],s=this._events[t]){if(o=[],n||i)for(u=0,c=s.length;c>u;u++)r=s[u],(n&&n!==r.callback&&n!==r.callback._callback||i&&i!==r.context)&&o.push(r);this._events[t]=o}return this},trigger:function(t){if(!this._events)return this;var i=Array.prototype.slice.call(arguments,1);if(!e(this,"trigger",t,i))return this;var s=this._events[t],r=this._events.all;return s&&n(s,i),r&&n(r,arguments),this},listenTo:function(t,e,n){return(this._listeners||(this._listeners={}))[t._listenerId||(t._listenerId=_.uniqueId("l"))]=t,t.on(e,"object"==typeof e?this:n,this),this},stopListening:function(t,e,n){var i=this._listeners;if(i){if(t)t.off(e,"object"==typeof e?this:n,this),e||n||delete i[t._listenerId];else{"object"==typeof e&&(n=this);for(var s in i)i[s].off(e,n,this);this._listeners={}}return this}}};return i.bind=i.on,i.unbind=i.off,i}()}(),function(){var t,e,n,i,s,r,o,a,l,h,u,c={}.hasOwnProperty,d=function(t,e){function n(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p=[].slice,f=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};t=jQuery,r=null!=(l=window._)?l:window.Messenger._,i=null!=(h="undefined"!=typeof Backbone&&null!==Backbone?Backbone.Events:void 0)?h:window.Messenger.Events,n=function(){function e(e){t.extend(this,i),r.isObject(e)&&(e.el&&this.setElement(e.el),this.model=e.model),this.initialize.apply(this,arguments)}return e.prototype.setElement=function(e){return this.$el=t(e),this.el=this.$el[0]},e.prototype.delegateEvents=function(t){var e,n,i,s,o,a,l;if(t||(t=r.result(this,"events"))){this.undelegateEvents(),e=/^(\S+)\s*(.*)$/,l=[];for(i in t){if(o=t[i],r.isFunction(o)||(o=this[t[i]]),!o)throw Error('Method "'+t[i]+'" does not exist');n=(s=i.match(e))[1],a=s[2],o=r.bind(o,this),n+=".delegateEvents"+this.cid,""===a?l.push(this.jqon(n,o)):l.push(this.jqon(n,a,o))}return l}},e.prototype.jqon=function(t,e,n){var i;return null!=this.$el.on?(i=this.$el).on.apply(i,arguments):(null==n&&(n=e,e=void 0),null!=e?this.$el.delegate(e,t,n):this.$el.bind(t,n))},e.prototype.jqoff=function(t){var e;return null!=this.$el.off?(e=this.$el).off.apply(e,arguments):(this.$el.undelegate(),this.$el.unbind(t))},e.prototype.undelegateEvents=function(){return this.jqoff(".delegateEvents"+this.cid)},e.prototype.remove=function(){return this.undelegateEvents(),this.$el.remove()},e}(),o=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,n),e.prototype.defaults={hideAfter:10,scroll:!0},e.prototype.initialize=function(e){return null==e&&(e={}),this.shown=!1,this.rendered=!1,this.messenger=e.messenger,this.options=t.extend({},this.options,e,this.defaults)},e.prototype.show=function(){var t;return this.rendered||this.render(),this.$message.removeClass("messenger-hidden"),t=this.shown,this.shown=!0,t?void 0:this.trigger("show")},e.prototype.hide=function(){var t;if(this.rendered)return this.$message.addClass("messenger-hidden"),t=this.shown,this.shown=!1,t?this.trigger("hide"):void 0},e.prototype.cancel=function(){return this.hide()},e.prototype.update=function(e){var n,i=this;return r.isString(e)&&(e={message:e}),t.extend(this.options,e),this.lastUpdate=new Date,this.rendered=!1,this.events=null!=(n=this.options.events)?n:{},this.render(),this.actionsToEvents(),this.delegateEvents(),this.checkClickable(),this.options.hideAfter?(this.$message.addClass("messenger-will-hide-after"),null!=this._hideTimeout&&clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){return i.hide()},1e3*this.options.hideAfter)):this.$message.removeClass("messenger-will-hide-after"),this.options.hideOnNavigate?(this.$message.addClass("messenger-will-hide-on-navigate"),null!=("undefined"!=typeof Backbone&&null!==Backbone?Backbone.history:void 0)&&Backbone.history.on("route",function(){return i.hide()})):this.$message.removeClass("messenger-will-hide-on-navigate"),this.trigger("update",this)},e.prototype.scrollTo=function(){return this.options.scroll?t.scrollTo(this.$el,{duration:400,offset:{left:0,top:-20}}):void 0},e.prototype.timeSinceUpdate=function(){return this.lastUpdate?new Date-this.lastUpdate:null},e.prototype.actionsToEvents=function(){var t,e,n,i,s=this;n=this.options.actions,i=[];for(e in n)t=n[e],i.push(this.events['click [data-action="'+e+'"] a']=function(t){return function(n){return n.preventDefault(),n.stopPropagation(),s.trigger("action:"+e,t,n),t.action.call(s,n,s)}}(t));return i},e.prototype.checkClickable=function(){var t,e,n;e=this.events,n=[];for(t in e)e[t],"click"===t?n.push(this.$message.addClass("messenger-clickable")):n.push(void 0);return n},e.prototype.undelegateEvents=function(){var t;return e.__super__.undelegateEvents.apply(this,arguments),null!=(t=this.$message)?t.removeClass("messenger-clickable"):void 0},e.prototype.parseActions=function(){var e,n,i,s,r;n=[],r=this.options.actions;for(s in r)e=r[s],i=t.extend({},e),i.name=s,null==i.label&&(i.label=s),n.push(i);return n},e.prototype.template=function(e){var n,i,s,r,o,a,l,h,u,c,d=this;for(o=t("<div class='messenger-message message alert "+e.type+" message-"+e.type+" alert-"+e.type+"'>"),e.showCloseButton&&((s=t('<button type="button" class="messenger-close" data-dismiss="alert">&times;</button>')).click(function(){return d.cancel(),!0}),o.append(s)),a=t('<div class="messenger-message-inner">'+e.message+"</div>"),o.append(a),e.actions.length&&(i=t('<div class="messenger-actions">')),h=0,u=(c=e.actions).length;u>h;h++)l=c[h],(n=t("<span>")).attr("data-action",""+l.name),(r=t("<a>")).html(l.label),n.append(t('<span class="messenger-phrase">')),n.append(r),i.append(n);return o.append(i),o},e.prototype.render=function(){var e;if(!this.rendered)return this._hasSlot||(this.setElement(this.messenger._reserveMessageSlot(this)),this._hasSlot=!0),e=t.extend({},this.options,{actions:this.parseActions()}),this.$message=t(this.template(e)),this.$el.html(this.$message),this.shown=!0,this.rendered=!0,this.trigger("render")},e}(),s=function(){function t(){return t.__super__.constructor.apply(this,arguments)}return d(t,o),t.prototype.initialize=function(){return t.__super__.initialize.apply(this,arguments),this._timers={}},t.prototype.cancel=function(){return this.clearTimers(),this.hide(),null!=this._actionInstance&&null!=this._actionInstance.abort?this._actionInstance.abort():void 0},t.prototype.clearTimers=function(){var t,e,n,i;n=this._timers;for(t in n)e=n[t],clearTimeout(e);return this._timers={},null!=(i=this.$message)?i.removeClass("messenger-retry-soon messenger-retry-later"):void 0},t.prototype.render=function(){var e,n,i,s;t.__super__.render.apply(this,arguments),this.clearTimers(),i=this.options.actions,s=[];for(n in i)(e=i[n]).auto?s.push(this.startCountdown(n,e)):s.push(void 0);return s},t.prototype.renderPhrase=function(t,e){return t.phrase.replace("TIME",this.formatTime(e))},t.prototype.formatTime=function(t){var e;return e=function(t,e){return 1!==(t=Math.floor(t))&&(e+="s"),"in "+t+" "+e},0===Math.floor(t)?"now...":60>t?e(t,"second"):60>(t/=60)?e(t,"minute"):(t/=60,e(t,"hour"))},t.prototype.startCountdown=function(t,e){var n,i,s,r,o=this;if(null==this._timers[t])return n=this.$message.find("[data-action='"+t+"'] .messenger-phrase"),10>=(i=null!=(r=e.delay)?r:3)?(this.$message.removeClass("messenger-retry-later"),this.$message.addClass("messenger-retry-soon")):(this.$message.removeClass("messenger-retry-soon"),this.$message.addClass("messenger-retry-later")),(s=function(){var r;return n.text(o.renderPhrase(e,i)),i>0?(r=Math.min(i,1),i-=r,o._timers[t]=setTimeout(s,1e3*r)):(o.$message.removeClass("messenger-retry-soon messenger-retry-later"),delete o._timers[t],e.action())})()},t}(),a=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,n),e.prototype.tagName="ul",e.prototype.className="messenger",e.prototype.messageDefaults={type:"info"},e.prototype.initialize=function(e){return this.options=null!=e?e:{},this.history=[],this.messageDefaults=t.extend({},this.messageDefaults,this.options.messageDefaults)},e.prototype.render=function(){return this.updateMessageSlotClasses()},e.prototype.findById=function(t){return r.filter(this.history,function(e){return e.msg.options.id===t})},e.prototype._reserveMessageSlot=function(e){var n,i,s=this;for((n=t("<li>")).addClass("messenger-message-slot"),this.$el.prepend(n),this.history.push({msg:e,$slot:n}),this._enforceIdConstraint(e),e.on("update",function(){return s._enforceIdConstraint(e)});this.options.maxMessages&&this.history.length>this.options.maxMessages;)(i=this.history.shift()).msg.remove(),i.$slot.remove();return n},e.prototype._enforceIdConstraint=function(t){var e,n,i,s,r;if(null!=t.options.id)for(r=this.history,n=0,i=r.length;i>n;n++)if(e=r[n],null!=(s=e.msg).options.id&&s.options.id===t.options.id&&t!==s){if(t.options.singleton)return void t.hide();s.hide()}},e.prototype.newMessage=function(t){var e,n,i,r,a=this;return null==t&&(t={}),t.messenger=this,o=null!=(n=null!=(i=Messenger.themes[null!=(r=t.theme)?r:this.options.theme])?i.Message:void 0)?n:s,(e=new o(t)).on("show",function(){return t.scrollTo&&"fixed"!==a.$el.css("position")?e.scrollTo():void 0}),e.on("hide show render",this.updateMessageSlotClasses,this),e},e.prototype.updateMessageSlotClasses=function(){var t,e,n,i,s,r,o;for(i=!0,e=null,t=!1,s=0,r=(o=this.history).length;r>s;s++)(n=o[s]).$slot.removeClass("messenger-first messenger-last messenger-shown"),n.msg.shown&&n.msg.rendered&&(n.$slot.addClass("messenger-shown"),t=!0,e=n,i&&(i=!1,n.$slot.addClass("messenger-first")));return null!=e&&e.$slot.addClass("messenger-last"),this.$el[(t?"remove":"add")+"Class"]("messenger-empty")},e.prototype.hideAll=function(){var t,e,n,i,s;for(s=[],e=0,n=(i=this.history).length;n>e;e++)t=i[e],s.push(t.msg.hide());return s},e.prototype.post=function(e){var n;return r.isString(e)&&(e={message:e}),e=t.extend(!0,{},this.messageDefaults,e),(n=this.newMessage(e)).update(e),n},e}(),e=function(){function e(){return e.__super__.constructor.apply(this,arguments)}return d(e,a),e.prototype.doDefaults={progressMessage:null,successMessage:null,errorMessage:"Error connecting to the server.",showSuccessWithoutError:!0,retry:{auto:!0,allow:!0},action:t.ajax},e.prototype.hookBackboneAjax=function(e){var n,i=this;if(null==e&&(e={}),null==window.Backbone)throw"Expected Backbone to be defined";return e=r.defaults(e,{id:"BACKBONE_ACTION",errorMessage:!1,successMessage:"Request completed successfully.",showSuccessWithoutError:!1}),n=function(t){var n;return n=r.extend({},e,t.messenger),i["do"](n,t)},null!=Backbone.ajax?(Backbone.ajax._withoutMessenger&&(Backbone.ajax=Backbone.ajax._withoutMessenger),(null==e.action||e.action===this.doDefaults.action)&&(e.action=Backbone.ajax),n._withoutMessenger=Backbone.ajax,Backbone.ajax=n):Backbone.sync=r.wrap(Backbone.sync,function(){var e,i,s;return s=arguments[0],e=arguments.length>=2?p.call(arguments,1):[],i=t.ajax,t.ajax=n,s.call.apply(s,[this].concat(p.call(e))),t.ajax=i})},e.prototype._getHandlerResponse=function(t){return!1!==t&&(!0===t||null==t||t)},e.prototype._parseEvents=function(t){var e,n,i,s,r,o;null==t&&(t={}),r={};for(s in t)i=t[s],n=s.indexOf(" "),o=s.substring(0,n),e=s.substring(n+1),null==r[o]&&(r[o]={}),r[o][e]=i;return r},e.prototype._normalizeResponse=function(){var t,e,n,i,s,o,a;for(i=null,s=null,t=null,o=0,a=(n=arguments.length>=1?p.call(arguments,0):[]).length;a>o;o++)"success"===(e=n[o])||"timeout"===e||"abort"===e?i=e:null!=(null!=e?e.readyState:void 0)&&null!=(null!=e?e.responseText:void 0)?s=e:r.isObject(e)&&(t=e);return[i,t,s]},e.prototype.run=function(){var e,n,i,s,o,a,l,h,u,c,d=this;if(a=arguments[0],h=arguments[1],e=arguments.length>=3?p.call(arguments,2):[],null==h&&(h={}),a=t.extend(!0,{},this.messageDefaults,this.doDefaults,null!=a?a:{}),n=this._parseEvents(a.events),i=function(t,e){var n;return n=a[t+"Message"],r.isFunction(n)?n.call(d,t,e):n},l=null!=(c=a.messageInstance)?c:this.newMessage(a),null!=a.id&&(l.options.id=a.id),null!=a.progressMessage&&l.update(t.extend({},a,{message:i("progress",null),type:"info"})),o={},r.each(["error","success"],function(s){var u;return u=h[s],o[s]=function(){var o,c,g,v,m,y,_,w,b,x,E,C;return m=arguments.length>=1?p.call(arguments,0):[],w=d._normalizeResponse.apply(d,m),v=w[0],w[1],_=w[2],"success"===s&&null==l.errorCount&&!1===a.showSuccessWithoutError&&(a.successMessage=null),"error"===s&&(null==a.errorCount&&(a.errorCount=0),a.errorCount+=1),c=a.returnsPromise?m[0]:"function"==typeof u?u.apply(null,m):void 0,y=d._getHandlerResponse(c),r.isString(y)&&(y={message:y}),"error"!==s||0!==(null!=_?_.status:void 0)&&"abort"!==v?"error"===s&&null!=a.ignoredErrorCodes&&(b=null!=_?_.status:void 0,f.call(a.ignoredErrorCodes,b)>=0)?void l.hide():(o={message:i(s,_),type:s,events:null!=(x=n[s])?x:{},hideOnNavigate:"success"===s},g=t.extend({},a,o,y),"number"==typeof(null!=(E=g.retry)?E.allow:void 0)&&g.retry.allow--,"error"===s&&(null!=_?_.status:void 0)>=500&&(null!=(C=g.retry)?C.allow:void 0)?(null==g.retry.delay&&(g.retry.delay=4>g.errorCount?10:300),g.hideAfter&&(null==g._hideAfter&&(g._hideAfter=g.hideAfter),g.hideAfter=g._hideAfter+g.retry.delay),g._retryActions=!0,g.actions={retry:{label:"retry now",phrase:"Retrying TIME",auto:g.retry.auto,delay:g.retry.delay,action:function(){return g.messageInstance=l,setTimeout(function(){return d["do"].apply(d,[g,h].concat(p.call(e)))},0)}},cancel:{action:function(){return l.cancel()}}}):g._retryActions&&(delete g.actions.retry,delete g.actions.cancel,delete a._retryActions),l.update(g),y&&g.message?(Messenger(),l.show()):l.hide()):void l.hide()}}),!a.returnsPromise)for(u in o)s=o[u],h[u],h[u]=s;return l._actionInstance=a.action.apply(a,[h].concat(p.call(e))),a.returnsPromise&&l._actionInstance.then(o.success,o.error),l},e.prototype["do"]=e.prototype.run,e.prototype.ajax=function(){var e,n;return n=arguments[0],e=arguments.length>=2?p.call(arguments,1):[],n.action=t.ajax,this.run.apply(this,[n].concat(p.call(e)))},e.prototype.expectPromise=function(t,e){return e=r.extend({},e,{action:t,returnsPromise:!0}),this.run(e)},e.prototype.error=function(t){return null==t&&(t={}),"string"==typeof t&&(t={message:t}),t.type="error",this.post(t)},e.prototype.info=function(t){return null==t&&(t={}),"string"==typeof t&&(t={message:t}),t.type="info",this.post(t)},e.prototype.success=function(t){return null==t&&(t={}),"string"==typeof t&&(t={message:t}),t.type="success",
this.post(t)},e}(),t.fn.messenger=function(){var n,i,s,o,l,h,u,c;return s=arguments[0],i=arguments.length>=2?p.call(arguments,1):[],null==s&&(s={}),n=this,null!=s&&r.isString(s)?(c=n.data("messenger"))[s].apply(c,i):(l=s,null==n.data("messenger")&&(a=null!=(h=null!=(u=Messenger.themes[l.theme])?u.Messenger:void 0)?h:e,n.data("messenger",o=new a(t.extend({el:n},l))),o.render()),n.data("messenger"))},window.Messenger._call=function(e){var n,i,s,r,o,a,l,h,u,c;if(o={extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right",theme:"future",maxMessages:9,parentLocations:["body"]},null!=(e=t.extend(o,t._messengerDefaults,Messenger.options,e)).theme&&(e.extraClasses+=" messenger-theme-"+e.theme),a=e.instance||Messenger.instance,null==e.instance){for(i=null,null,u=0,c=(h=e.parentLocations).length;c>u;u++)if(l=h[u],(i=t(l)).length){s=l;break}a?t(a._location)!==t(s)&&(a.$el.detach(),i.prepend(a.$el)):(n=t("<ul>"),i.prepend(n),a=n.messenger(e),a._location=s,Messenger.instance=a)}return null!=a._addedClasses&&a.$el.removeClass(a._addedClasses),a.$el.addClass(r=a.className+" "+e.extraClasses),a._addedClasses=r,a},t.extend(Messenger,{Message:s,Messenger:e,themes:null!=(u=Messenger.themes)?u:{}}),t.globalMessenger=window.Messenger=Messenger}.call(this),function(){var t,e,n,i={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};t=jQuery,n='<div class="messenger-spinner">\n    <span class="messenger-spinner-side messenger-spinner-side-left">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n    <span class="messenger-spinner-side messenger-spinner-side-right">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n</div>',e=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return s(i,e),i.prototype.template=function(){var e;return(e=i.__super__.template.apply(this,arguments)).append(t(n)),e},i}(window.Messenger.Message),window.Messenger.themes.future={Message:e}}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var s in n)e.call(n,s)&&(t[s]=n[s]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.className="location-selector",e.prototype.events={"click .bit":"handleClick"},e.prototype.render=function(){return this.$el.html(""),this.draw()},e.prototype.draw=function(){return this._addBit("top left"),this._addBit("top right"),this._addBit("top"),this._addBit("bottom left"),this._addBit("bottom right"),this._addBit("bottom")},e.prototype._addBit=function(t){var e;return(e=$("<div>")).addClass("bit "+t),e.attr("data-position",t),this.$el.append(e),e},e.prototype.handleClick=function(t){var e;return e=$(t.target),this.trigger("update",e.attr("data-position").split(" "))},e}(Backbone.View),$.fn.locationSelector=function(e){var n;return n=new t($.extend({},e,{el:this})),$(this).addClass(n.className),n.render(),n}}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var s in n)e.call(n,s)&&(t[s]=n[s]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.tagName="ul",e.prototype.className="theme-selector",e.prototype.events={"click li":"handleClick"},e.prototype.handleClick=function(t){var e;return e=$(t.target),this.trigger("update",e.attr("data-id"))},e}(Backbone.View),$.fn.themeSelector=function(e){var n;return n=new t($.extend({},e,{el:this})),$(this).addClass(n.className),n.render(),n}}.call(this);